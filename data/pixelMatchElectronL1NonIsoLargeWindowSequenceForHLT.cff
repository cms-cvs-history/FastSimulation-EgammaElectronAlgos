#
# create a sequence with all required modules and sources needed to make
# pixel based electrons
#
# NB: it assumes that ECAL clusters (hybrid) are in the event
#
#

# modules to make seeds, tracks and electrons
# include "RecoEgamma/EgammaHLTProducers/data/egammaHLTChi2MeasurementEstimatorESProducer.cff"


# Cluster-seeded pixel pairs
module hltL1NonIsoLargeWindowElectronPixelSeeds = electronGSPixelSeeds from "FastSimulation/EgammaElectronAlgos/data/electronGSPixelSeeds.cfi"
replace hltL1NonIsoLargeWindowElectronPixelSeeds.SeedConfiguration = { 
    using block_hltL1NonIsoLargeWindowElectronPixelSeeds
}

replace hltL1NonIsoLargeWindowElectronPixelSeeds.barrelSuperClusters = hltCorrectedHybridSuperClustersL1NonIsolated
replace hltL1NonIsoLargeWindowElectronPixelSeeds.endcapSuperClusters = hltCorrectedEndcapSuperClustersWithPreshowerL1NonIsolated

module hltCkfL1NonIsoLargeWindowTrackCandidates = trackCandidateProducer from "FastSimulation/Tracking/data/TrackCandidateProducer.cfi"
replace hltCkfL1NonIsoLargeWindowTrackCandidates.SeedProducer = hltL1NonIsoLargeWindowElectronPixelSeeds:
replace hltCkfL1NonIsoLargeWindowTrackCandidates.TrackProducers = { hltCtfL1NonIsoWithMaterialTracks: }
replace hltCkfL1NonIsoLargeWindowTrackCandidates.MaxNumberOfCrossedLayers = 999
replace hltCkfL1NonIsoLargeWindowTrackCandidates.SeedCleaning = true

# CTF track fit with material
module ctfL1NonIsoLargeWindowTracks = ctfWithMaterialTracks from "RecoTracker/TrackProducer/data/CTFFinalFitWithMaterial.cfi"
replace ctfL1NonIsoLargeWindowTracks.src = hltCkfL1NonIsoLargeWindowTrackCandidates
replace ctfL1NonIsoLargeWindowTracks.TTRHBuilder = "WithoutRefit"
replace ctfL1NonIsoLargeWindowTracks.Fitter = "KFFittingSmoother"
replace ctfL1NonIsoLargeWindowTracks.Propagator = "PropagatorWithMaterial"

module hltCtfL1NonIsoLargeWindowWithMaterialTracks = FastTrackMerger {

    VInputTag TrackProducers = { 
	ctfL1NonIsoLargeWindowTracks,
	hltCtfL1NonIsoWithMaterialTracks
    }

    untracked bool SaveTracksOnly = true

}

# Electron collection
# include "RecoEgamma/EgammaHLTProducers/data/pixelMatchElectronsL1NonIsoLargeWindowForHLT.cff"

# sequence HLTPixelMatchElectronL1NonIsoLargeWindowSequence = {
#     hltL1NonIsoLargeWindowElectronPixelSeeds
# }

sequence HLTPixelMatchElectronL1NonIsoLargeWindowTrackingSequence = {
    hltCkfL1NonIsoLargeWindowTrackCandidates &
    ctfL1NonIsoLargeWindowTracks &
    hltCtfL1NonIsoLargeWindowWithMaterialTracks &
    hltPixelMatchElectronsL1NonIsoLargeWindow
}

